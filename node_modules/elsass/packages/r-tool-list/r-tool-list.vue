<template>
  <div class="r-tool-list">
    <div class="r-tool-list-inner">
      <RBreadcrumb :class="'r-tool-list-breadcrumb'" :items="navigation"
                   :showAsterisk="showAsterisk"
                   @click_asterisk="click_asterisk"></RBreadcrumb>
      <div class="r-tool-list-slot">
        <div v-if="useEnter" class="r-fast-enter">
          <div v-for="enter of showEnters.slice(0, maxEnterCount)" :key="`enter-${enter.name}`" class="r-fast-enter-item">
            <template v-if="enter.icon">
              <template v-if="enter.icon.match('icon')">
                <RIcon :icon-class="enter.icon" class="r-fast-enter-icon"></RIcon>
              </template>
              <template v-else-if="enter.icon.match('http')">
                <img :src="enter.icon" class="r-fast-enter-icon">
              </template>
              <template v-else>
                <Icon :type="enter.icon" class="r-fast-enter-icon" />
              </template>
            </template>
            <template v-if="enter.to">
              <a :href="linkUrl(enter.to, enter.expand)" :target="enter.target"
                  @click.exact="handleCheckClick($event, enter, false)"
                  @click.ctrl="handleCheckClick($event, enter, true)"
                  @click.meta="handleCheckClick($event, enter, true)">{{enter.title}}</a>
            </template>
            <template v-else>
              <div class="r-enter-item-inner" @click="click_enter(enter)">
                {{enter.title}}
              </div>
            </template>
          </div>
          <template v-if="showEnters.length > maxEnterCount">
            <div class="r-tool-list-show-more-enter">
              <Dropdown>
                <a href="javascript:void(0)">
                  更多
                  <Icon type="ios-arrow-down"></Icon>
                </a>
                <DropdownMenu slot="list">
                  <DropdownItem v-for="enter in showEnters.slice(maxEnterCount)" :key="`show-more-enter-${enter.name}`">{{enter.title}}</DropdownItem>
                </DropdownMenu>
              </Dropdown>
            </div>
          </template>
        </div>
        <slot v-else></slot>
      </div>
      <div class="r-tool-list-operate">
        <span @click="onreturn">
          <RIcon class="r-tool-list-operate-icon" icon-class="icon-return"></RIcon>
        </span>
        <span @click="onrefresh">
          <RIcon class="r-tool-list-operate-icon" icon-class="icon-refresh"></RIcon>
        </span>
      </div>
    </div>
  </div>
</template>

<script>
import str from '../../util/string'
import mixinsLink from '../../src/mixins/link'
import RIcon from '../../packages/r-icon/r-icon'
export default {
  name: 'RToolList',
  mixins: [ mixinsLink ],
  props: {
    navigation: {
      type: Array,
      default () {
        return []
      }
    }, // 面包屑导航路
    enters: {
      type: Array,
      default () {
        return []
      }
    }, // 快捷入口
    useEnter: {
      type: Boolean,
      default: false
    }, // 是否使用默认的快捷入口
    maxEnterCount: {
      type: Number,
      default: 6
    }, // 默认显示的快捷入口数量
    maxTextLength: {
      type: Number,
      default: 10
    }, // 默认快捷入口最长字节数
    showAsterisk: {
      type: Boolean,
      default: false
    } // 是否显示收藏图标
    // fixed: {
    //   type: Boolean,
    //   default: false
    // }
  },
  computed: {
    showEnters () {
      // 默认只显示十个字节（五个中文）的项
      return this.enters.filter(enter => !str.overLen(enter.title, this.maxTextLength))
    }
  },
  methods: {
    // 设置定位
    set_fixed () {
      // document.onscroll = function (e) {
      //   let $node = this.$vnode
      //   if ($node.style.position !== 'fixed') {
      //     $node.style.height = $node.clientHeight + 'px'
      //     $node.style.width = $node.clientWidth + 'px'
      //     let hoderDiv = document.createElement('div')
      //     hoderDiv.style.height =  $node.clientHeight + 'px'
      //     hoderDiv.style.width =  $node.clientHeight + 'px'
      //     $node.parentElement.append(hoderDiv) // 有问题
      //   }
      // }
    },
    // 点击返回
    onreturn () {
      this.$emit('onreturn')
    },
    onrefresh () {
      this.$emit('onrefresh')
    },
    click_enter (item) {
      this.$emit('click-enter-item', {item: item})
    },
    click_breadcrum (item) {
      this.$emit('click-breadcrumb-item', {item: item})
    },
    click_asterisk (args) {
      this.$emit('click_asterisk', args)
    }
  },
  components: {
    RIcon
  }
}
</script>